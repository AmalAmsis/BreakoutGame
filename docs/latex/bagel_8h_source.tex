\doxysection{bagel.\+h}
\hypertarget{bagel_8h_source}{}\label{bagel_8h_source}\index{engine/bagel.h@{engine/bagel.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ (C)\ 2025\ Moshe\ Sulamy}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <cstdint>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <cstring>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <algorithm>}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <type\_traits>}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{keyword}{namespace\ }bagel}
\DoxyCodeLine{00010\ \{}
\DoxyCodeLine{00011\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structbagel_1_1_bagel}{Bagel}}}
\DoxyCodeLine{00012\ \ \ \ \ \{}
\DoxyCodeLine{00013\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ AggregateUpdates\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00014\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ CallbackOnDestroy\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00015\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ DynamicResize\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00016\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \ \ \ \ IdBagSize\ =\ 5;}
\DoxyCodeLine{00017\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \ \ \ \ InitialEntities\ =\ 10;}
\DoxyCodeLine{00018\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \ \ \ \ InitialPackedSize\ =\ 5;}
\DoxyCodeLine{00019\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \ \ \ \ MaxComponents\ =\ 10;}
\DoxyCodeLine{00020\ \ \ \ \ \};}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structbagel_1_1_storage}{Storage}};}
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classbagel_1_1_packed_storage}{PackedStorage}};}
\DoxyCodeLine{00024\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classbagel_1_1_sparse_storage}{SparseStorage}};}
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classbagel_1_1_tagged_storage}{TaggedStorage}};}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#if\ \_\_has\_include("{}bagel\_cfg.h"{})}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\ \ \ \ \#define\ BAGEL\_STORAGE(C,T)\ template\ <>\ struct\ Storage<C>\ \{\ using\ type\ =\ T<C>;\ \};}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\ \ \ \ \#include\ "{}bagel\_cfg.h"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\ \ \ \ \#undef\ BAGEL\_STORAGE}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{structbagel_1_1_bagel}{Bagel}}\ Params\{\};}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keyword}{using\ }id\_type\ =\ int;}
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ \{\ id\_type\ id;\ \};}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{keyword}{using\ }size\_type\ =\ int;}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keyword}{using\ }index\_type\ =\ int;}
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{keyword}{using\ }mask\_type\ =}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ std::conditional\_t<Params.MaxComponents<=8,\ std::uint\_fast8\_t,}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ std::conditional\_t<Params.MaxComponents<=16,\ std::uint\_fast16\_t,}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ std::conditional\_t<Params.MaxComponents<=32,\ std::uint\_fast32\_t,}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ std::uint\_fast64\_t>>>;}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{inline}\ size\_type\ BitsetWidth\ =\ \textcolor{keyword}{sizeof}(mask\_type)*8;}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keyword}{class\ }NoInstance\ \{\ NoInstance()\ =\ \textcolor{keyword}{delete};\ \};}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keyword}{struct\ }NoCopy\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ NoCopy()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ NoCopy(\textcolor{keyword}{const}\ NoCopy\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ operator=(\textcolor{keyword}{const}\ NoCopy\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00051\ \ \ \ \ \};}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T,\ \textcolor{keywordtype}{int}\ N>}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classbagel_1_1_dynamic_bag}{DynamicBag}}\ :\ NoCopy}
\DoxyCodeLine{00055\ \ \ \ \ \{}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ push(\textcolor{keyword}{const}\ T\&\ t)\ \{}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_size\ ==\ \_capacity)\ \{}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_capacity\ *=\ 2;}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_arr\ =\ \textcolor{keyword}{static\_cast<}T*\textcolor{keyword}{>}(}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ realloc(\_arr,\ \textcolor{keyword}{sizeof}(T)*\_capacity));}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \_arr[\_size]\ =\ t;}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ ++\_size;}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ ensure(size\_type\ s)\ \{}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_capacity\ <\ s)\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_capacity\ =\ std::max(s,\ \_capacity*2);}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_arr\ =\ \textcolor{keyword}{static\_cast<}T*\textcolor{keyword}{>}(}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ realloc(\_arr,\ \textcolor{keyword}{sizeof}(T)*\_capacity));}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ T\ pop()\ \{\ \textcolor{keywordflow}{return}\ \_arr[-\/-\/\_size];\ \}}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ T\&\ operator[](index\_type\ i)\ \{\ \textcolor{keywordflow}{return}\ \_arr[i];\ \}}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ T\&\ operator[](index\_type\ i)\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \_arr[i];\ \}}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ clear()\ \{\ \_size\ =\ 0;\ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ size\_type\ size()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \_size;\ \}}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ size\_type\ capacity()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \_capacity;\ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbagel_1_1_dynamic_bag}{\string~DynamicBag}}()\ \{\ free(\_arr);\ \}}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ T*\ \ \ \ \ \ \ \ \ \ \_arr\ =\ \textcolor{keyword}{static\_cast<}T*\textcolor{keyword}{>}(malloc(\textcolor{keyword}{sizeof}(T)\ *\ N));}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ size\_type\ \ \ \_size\ =\ 0;}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ size\_type\ \ \ \_capacity\ =\ N;}
\DoxyCodeLine{00086\ \ \ \ \ \};}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T,\ \textcolor{keywordtype}{int}\ N>}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classbagel_1_1_static_bag}{StaticBag}}}
\DoxyCodeLine{00089\ \ \ \ \ \{}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ push(\textcolor{keyword}{const}\ T\&\ t)\ \{\ \_arr[\_size++]\ =\ t;\ \}}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ T\ pop()\ \{\ \textcolor{keywordflow}{return}\ \_arr[-\/-\/\_size];\ \}}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ T\&\ operator[](index\_type\ i)\ \{\ \textcolor{keywordflow}{return}\ \_arr[i];\ \}}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ T\&\ operator[](index\_type\ i)\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \_arr[i];\ \}}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ clear()\ \{\ \_size\ =\ 0;\ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ size\_type\ size()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \_size;\ \}}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ size\_type\ capacity()\ \{\ \textcolor{keywordflow}{return}\ N;\ \}}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ ensure(size\_type)\ \{\}}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ T\ \ \ \ \ \ \ \ \ \ \ \_arr[N];}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ size\_type\ \ \ \_size\ =\ 0;}
\DoxyCodeLine{00103\ \ \ \ \ \};}
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T,\ \textcolor{keywordtype}{int}\ N>}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keyword}{using\ }Bag\ =\ std::conditional\_t<Params.DynamicResize,\ \mbox{\hyperlink{classbagel_1_1_dynamic_bag}{DynamicBag<T,\ N>}},\ \mbox{\hyperlink{classbagel_1_1_static_bag}{StaticBag<T,N>}}>;}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structbagel_1_1_storage_callbacks}{StorageCallbacks}}}
\DoxyCodeLine{00108\ \ \ \ \ \{}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }Destroy\ =\ void\ (*)(\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}});}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ Destroy\ destroy\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00111\ \ \ \ \ \};}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}>\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classbagel_1_1_storage_register}{StorageRegister}};}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classbagel_1_1_sparse_storage}{SparseStorage}}\ final\ :\ NoInstance}
\DoxyCodeLine{00116\ \ \ \ \ \{}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ add(\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ e,\ \textcolor{keyword}{const}\ T\&\ t)\ \{}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ \_bag.ensure(e.id);}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ \_bag[e.id]\ =\ t;}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ del(\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}})\ \{\}}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ T\&\ get(\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ e)\ \{\ \textcolor{keywordflow}{return}\ \_bag[e.id];\ \}}
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ Bag<T,Params.InitialEntities>\ \_bag;}
\DoxyCodeLine{00126\ \ \ \ \ \};}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classbagel_1_1_packed_storage}{PackedStorage}}\ final\ :\ NoInstance}
\DoxyCodeLine{00129\ \ \ \ \ \{}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ add(\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ e,\ \textcolor{keyword}{const}\ T\&\ t)\ \{}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \_entToComp.ensure(e.id);}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \_entToComp[e.id]\ =\ \_comps.size();}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \_comps.push(t);}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \ \ \ \ \_compToEnt.push(e);}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ del(\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ e)\ \{}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \ \ \ \ index\_type\ ent\_comp\_idx\ =\ \_entToComp[e.id];}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ last\_ent\ =\ \_compToEnt.pop();}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \_comps[ent\_comp\_idx]\ =\ \_comps.pop();}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \_compToEnt[ent\_comp\_idx]\ =\ last\_ent;}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \_entToComp[last\_ent.id]\ =\ ent\_comp\_idx;}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ T\&\ get(\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ e)\ \{}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_comps[\_entToComp[e.id]];}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ size()\ \{\ \textcolor{keywordflow}{return}\ \_comps.size();\ \}}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ T\&\ get(index\_type\ idx)\ \{}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_comps[idx];}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ entity(index\_type\ idx)\ \{}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_compToEnt[idx];}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ Bag<T,Params.InitialPackedSize>\ \ \ \ \ \ \ \ \ \ \ \_comps;}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ Bag<index\_type,Params.InitialEntities>\ \ \ \ \_entToComp;}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ Bag<\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}},Params.InitialPackedSize>\ \ \ \ \_compToEnt;}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{structbagel_1_1_storage_callbacks}{StorageCallbacks}}\ callbacks\{del\};}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \_\_attribute\_\_((used))}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{classbagel_1_1_storage_register}{StorageRegister<T>}}\ reg\{callbacks\};}
\DoxyCodeLine{00164\ \ \ \ \ \};}
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classbagel_1_1_tagged_storage}{TaggedStorage}}\ final\ :\ NoInstance}
\DoxyCodeLine{00167\ \ \ \ \ \{}
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ add(\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}},\ \textcolor{keyword}{const}\ T\&)\ \{\}}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ del(\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}})\ \{\}}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ T\&\ get(\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}})\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00172\ \ \ \ \ \};}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structbagel_1_1_storage}{Storage}}\ final\ :\ NoInstance\ \{}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }type\ =\ \mbox{\hyperlink{classbagel_1_1_sparse_storage}{SparseStorage<T>}};}
\DoxyCodeLine{00177\ \ \ \ \ \};}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classbagel_1_1_single_mask}{SingleMask}}\ final}
\DoxyCodeLine{00180\ \ \ \ \ \{}
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }bit\_type\ =\ mask\_type;}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ bit\_type\ bit(index\_type\ idx)\ \{\ \textcolor{keywordflow}{return}\ 1<<idx;\ \}}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ set(\textcolor{keyword}{const}\ bit\_type\ b)\ \{\ \_mask\ |=\ b;\ \}}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ clear(\textcolor{keyword}{const}\ bit\_type\ b)\ \{\ \_mask\ \&=\ \string~b;\ \}}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ clear()\ \{\ \_mask\ =\ 0;\ \}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ test(\textcolor{keyword}{const}\ bit\_type\ b)\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \_mask\ \&\ b;\ \}}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ test(\textcolor{keyword}{const}\ \mbox{\hyperlink{classbagel_1_1_single_mask}{SingleMask}}\ m)\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ (\_mask\ \&\ m.\_mask)\ ==\ m.\_mask;\ \}}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ index\_type\ ctz()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \_mask\ ?\ \_\_builtin\_ctz(\_mask)\ :\ -\/1;\ \}}
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ mask\_type\ \ \ \_mask\{0\};}
\DoxyCodeLine{00196\ \ \ \ \ \};}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classbagel_1_1_multi_mask}{MultiMask}}\ final}
\DoxyCodeLine{00198\ \ \ \ \ \{}
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }bit\_type\ =\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ index\_type\ \ \ \ index;}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ mask\_type\ \ \ \ \ mask;}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ bit\_type\ bit(index\_type\ idx)\ \{}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{idx/BitsetWidth,\ \textcolor{keyword}{static\_cast<}mask\_type\textcolor{keyword}{>}(1<<(idx\%BitsetWidth))\};}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ set(\textcolor{keyword}{const}\ bit\_type\&\ b)\ \{\ \_masks[b.index]\ |=\ b.mask;\ \}}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ clear(\textcolor{keyword}{const}\ bit\_type\&\ b)\ \{\ \_masks[b.index]\ \&=\ \string~b.mask;\ \}}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ clear()\ \{\ memset(\_masks,\ 0,\ \textcolor{keyword}{sizeof}(\_masks));\ \}}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ test(\textcolor{keyword}{const}\ bit\_type\&\ b)\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \_masks[b.index]\ \&\ b.mask;\ \}}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ test(\textcolor{keyword}{const}\ \mbox{\hyperlink{classbagel_1_1_multi_mask}{MultiMask}}\&\ m)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (index\_type\ i\ =\ 0;\ i\ <\ Size;\ ++i)}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((\_masks[i]\ \&\ m.\_masks[i])\ !=\ m.\_masks[i])}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ index\_type\ ctz()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (index\_type\ i\ =\ 0;\ i\ <\ Size;\ ++i)\ \{}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_masks[i])\ \{}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ c\ =\ \_\_builtin\_ctz(\_masks[i]);}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ c\ +\ i*BitsetWidth;}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00230\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ size\_type\ \ Size\ =\ (Params.MaxComponents-\/1)/BitsetWidth\ +\ 1;}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ mask\_type\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_masks[Size]\ =\{\};}
\DoxyCodeLine{00233\ \ \ \ \ \};}
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{keyword}{using\ }Mask\ =\ std::conditional\_t<Params.MaxComponents<=BitsetWidth,\ \mbox{\hyperlink{classbagel_1_1_single_mask}{SingleMask}},\ \mbox{\hyperlink{classbagel_1_1_multi_mask}{MultiMask}}>;}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ index\_type\ compCounter\ =\ -\/1;}
\DoxyCodeLine{00237\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}>}
\DoxyCodeLine{00238\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structbagel_1_1_component}{Component}}\ final\ :\ NoInstance}
\DoxyCodeLine{00239\ \ \ \ \ \{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keyword}{const}\ index\_type\ \ \ \ \ \ Index\ =\ ++compCounter;}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keyword}{const}\ Mask::bit\_type\ \ Bit\ =\ Mask::bit(Index);}
\DoxyCodeLine{00242\ \ \ \ \ \};}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00244\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structbagel_1_1_added_mask}{AddedMask}}\ \{}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ Mask\ prev;}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ Mask\ next;}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ e;}
\DoxyCodeLine{00248\ \ \ \ \ \};}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00250\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classbagel_1_1_world}{World}}\ final\ :\ NoInstance}
\DoxyCodeLine{00251\ \ \ \ \ \{}
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ createEntity()\ \{}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_ids.size()\ >\ 0)}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_ids.pop();}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ \_masks.push(Mask\{\});}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{++\_maxId.id\};}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ destroyEntity(\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ ent)\ \{}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (Params.CallbackOnDestroy)\ \{}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Mask\ m\ =\ \_masks[ent.id];}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ ctz\ =\ m.ctz();\ \textcolor{comment}{//\ count-\/trailing-\/zeros}}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (ctz\ >=\ 0)\ \{}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_callbacks[ctz].destroy\ !=\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_callbacks-\/>destroy(ent);}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m.clear(Mask::bit(ctz));}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ctz\ =\ m.ctz();}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ \ \ \_masks[ent.id].clear();}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \ \ \_ids.push(ent);}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ Mask\&\ mask(\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ e)\ \{}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_masks[e.id];}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ maxId()\ \{\ \textcolor{keywordflow}{return}\ \_maxId;\ \}}
\DoxyCodeLine{00277\ }
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ T\&\ getComponent(\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ e)\ \{}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Storage<T>::type::get(e);}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ addComponent(\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ e,\ \textcolor{keyword}{const}\ T\&\ t)\ \{}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ Mask\ prev\ =\ \_masks[e.id];}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \ \ \_masks[e.id].set(Component<T>::Bit);}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ Storage<T>::type::add(e,t);}
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (Params.AggregateUpdates)\ \{}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Mask\ next\ =\ \_masks[e.id];}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_added.push(\{prev,next,e\});}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class\ }T,\ \textcolor{keyword}{class}...Ts>}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ addComponents(\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ e,\ \textcolor{keyword}{const}\ T\&\ t,\ \textcolor{keyword}{const}\ Ts\&...\ ts)\ \{}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ \ \ addComponent(e,\ t);}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (\textcolor{keyword}{sizeof}...(Ts)>0)}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ addComponents(e,\ ts...);}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ delComponent(\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ e)\ \{}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \ \ \ \ \_masks[e.id].clear(Component<T>::Bit);}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \ \ \ \ Storage<T>::type::del(e);}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class\ }T,\ \textcolor{keyword}{class\ }...Ts>}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ delComponents(\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ e)\ \{}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \ \ \ \ delComponent<T>(e);}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (\textcolor{keyword}{sizeof}...(Ts)>0)}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ delComponents<Ts...>(e);}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ registerStorage(\mbox{\hyperlink{structbagel_1_1_storage_callbacks}{StorageCallbacks}}\&\ cb)\ \{}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \ \ \ \ \_callbacks[Component<T>::Index]\ =\ cb;}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ size\_type\ sizeAdded()\ \{\ \textcolor{keywordflow}{return}\ \_added.size();\ \}}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbagel_1_1_added_mask}{AddedMask}}\&\ getAdded(\textcolor{keywordtype}{int}\ i)\ \{\ \textcolor{keywordflow}{return}\ \_added[i];\ \}}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ step()\ \{\ \_added.clear();\ \}}
\DoxyCodeLine{00323\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{structbagel_1_1_storage_callbacks}{StorageCallbacks}}\ \_callbacks[Params.MaxComponents]\ =\ \{\textcolor{keyword}{nullptr}\};}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ Bag<\mbox{\hyperlink{structbagel_1_1_added_mask}{AddedMask}},Params.IdBagSize>\ \ \ \ \ \ \_added;}
\DoxyCodeLine{00326\ }
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_maxId\{-\/1\};}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ Bag<Mask,\ \ \ \ \ Params.InitialEntities>\ \_masks;}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ Bag<\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}},\ Params.IdBagSize>\ \ \ \ \ \ \ \_ids;}
\DoxyCodeLine{00330\ \ \ \ \ \};}
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00332\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{00333\ \ \ \ \ \textcolor{keyword}{class\ }StorageRegister}
\DoxyCodeLine{00334\ \ \ \ \ \{}
\DoxyCodeLine{00335\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ StorageRegister(\mbox{\hyperlink{structbagel_1_1_storage_callbacks}{StorageCallbacks}}\&\ cb)\ \{}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \ \ \ \ World::registerStorage<T>(cb);}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00339\ \ \ \ \ \};}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00341\ \ \ \ \ \textcolor{keyword}{class\ }Entity}
\DoxyCodeLine{00342\ \ \ \ \ \{}
\DoxyCodeLine{00343\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ Entity(\mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ e)\ :\ \_ent(e)\ \{\}}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ entity()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \_ent;\ \}}
\DoxyCodeLine{00346\ }
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ Entity\ create()\ \{\ \textcolor{keywordflow}{return}\ World::createEntity();\ \}}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ destroy()\textcolor{keyword}{\ const\ }\{\ World::destroyEntity(\_ent);\ \}}
\DoxyCodeLine{00349\ }
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Mask\&\ mask()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ World::mask(\_ent);\ \}}
\DoxyCodeLine{00351\ }
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>\ T\&\ get()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ World::getComponent<T>(\_ent);\ \}}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>\ \textcolor{keywordtype}{void}\ add(\textcolor{keyword}{const}\ T\&\ t)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ World::addComponent<T>(\_ent,\ t);}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>\ \textcolor{keywordtype}{void}\ del()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ World::delComponent<T>(\_ent);}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class\ }T,\ \textcolor{keyword}{class\ }...Ts>\ \textcolor{keywordtype}{void}\ addAll(\textcolor{keyword}{const}\ T\&\ t,\ \textcolor{keyword}{const}\ Ts\&...\ ts)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \ \ \ \ World::addComponents(\_ent,\ t,\ ts...);}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class\ }T,\ \textcolor{keyword}{class\ }...Ts>\ \textcolor{keywordtype}{void}\ delAll()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ \ \ \ \ World::delComponents<T,Ts...>(\_ent);}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>\ \textcolor{keywordtype}{bool}\ has()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ mask().test(Component<T>::Bit);\ \}}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ test(\textcolor{keyword}{const}\ Mask\&\ m)\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ mask().test(m);\ \}}
\DoxyCodeLine{00369\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structbagel_1_1ent__type}{ent\_type}}\ \_ent;}
\DoxyCodeLine{00371\ \ \ \ \ \};}
\DoxyCodeLine{00372\ }
\DoxyCodeLine{00373\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classbagel_1_1_mask_builder}{MaskBuilder}}}
\DoxyCodeLine{00374\ \ \ \ \ \{}
\DoxyCodeLine{00375\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbagel_1_1_mask_builder}{MaskBuilder}}\&\ set()\ \{}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \ \ \ \ m.set(Component<T>::Bit);}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ Mask\ build()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ m;\ \}}
\DoxyCodeLine{00382\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ Mask\ m;}
\DoxyCodeLine{00384\ \ \ \ \ \};}
\DoxyCodeLine{00385\ \}}

\end{DoxyCode}
